package swax.web.controller.user;
import java.util.ArrayList;import java.util.List;import org.apache.log4j.Logger;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.ModelAttribute;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.servlet.ModelAndView;import swax.web.component.sessionscope.SessionUser;import swax.web.form.PojoModelSelectSwapsForm;import swax.webservice.entity.album.SwapAlbum;import swax.webservice.entity.user.User;import swax.webservice.service.album.ISwapAlbumService;import swax.webservice.service.user.IUserService;/** *  * @author Matthieu Ibarra * Controller for: * /saveAndSwapAlbum * */
@Controllerpublic class SearchSwapsController {		@Autowired	private ISwapAlbumService swapAlbumService;		@Autowired	private IUserService userService;		@Autowired	private SessionUser sessionUser;		private Logger logger = Logger.getLogger(this.getClass());		@RequestMapping(value="/swapsByUser")	public ModelAndView swapsByUser(@RequestParam(value="userId") final Integer userId, ModelAndView mav, PojoModelSelectSwapsForm selectSwapsForm) {				logger.debug(this.getClass().getName()+": swapsByUser");						User userToSee = userService.findByUserId(userId);				List<SwapAlbum> albumsToSwap = swapAlbumService.findByUser(userToSee);		List<SwapAlbum> albumsToReallySwap = new ArrayList<>();				albumsToSwap.stream()			.filter(s -> s.isAlbumToSwap())			.forEach(item -> albumsToReallySwap.add(item));				mav.getModel().put("albumsToSwap", albumsToReallySwap);			mav.getModel().put("user", sessionUser.getSessionUser());		mav.getModel().put("userToSee", userToSee);		mav.getModel().put("selectSwapsModelAttribute", selectSwapsForm);		mav.setViewName("swaps/swapsByUser");						return mav;			}		@RequestMapping(value="/sendProposition")	public ModelAndView sendProposition(@ModelAttribute final PojoModelSelectSwapsForm selectSwapsForm, ModelAndView mav) {				logger.debug(this.getClass().getName()+": sendProposition");		//		List<SwapAlbum> selectedAlbums;				for (String selectedId: selectSwapsForm.getAlbumsSelected()) {			System.out.println("Id sélectionné: "+selectedId);		}				mav.getModel().put("selectSwapsModelAttribute", new PojoModelSelectSwapsForm());		mav.setViewName("swaps/swapsByUser");						return mav;			}			
}
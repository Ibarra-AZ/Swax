package swax.web.controller.user;
import java.util.Date;import java.util.Map;import javax.servlet.http.HttpServletRequest;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.ModelAttribute;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestMethod;import org.springframework.web.servlet.ModelAndView;import swax.web.form.PojoModelImportWantlistForm;import swax.web.form.PojoModelSwapAlbumForm;import swax.webservice.entity.AlbumCollected;import swax.webservice.entity.SwapAlbum;import swax.webservice.entity.User;import swax.webservice.service.IAlbumCollectedService;import swax.webservice.service.ISwapAlbumService;import swax.webservice.service.IUserService;
@Controllerpublic class SwapAlbumController {	@Autowired	private IUserService userService = null;
	@Autowired	private IAlbumCollectedService albumCollectedService = null;		@Autowired	private ISwapAlbumService swapAlbumService = null;	
	@RequestMapping(value="/swapAlbum", method = RequestMethod.POST)	public ModelAndView changePassword(@ModelAttribute(value="swapAlbumModelAttribute" ) 			final PojoModelSwapAlbumForm swapAlbumForm, HttpServletRequest request, final ModelAndView mav) {				String errorMsg = "";		User user = (User) request.getSession().getAttribute("user");		AlbumCollected albumCollected = albumCollectedService.findByAlbumCollectedId(swapAlbumForm.getAlbumId());				SwapAlbum swapAlbum = new SwapAlbum();		swapAlbum.setSwapAlbumId(albumCollected.getAlbumCollectedId());		swapAlbum.setAlbumCollected(albumCollected);		swapAlbum.setUser(user);		swapAlbum.setMediaGrading(swapAlbumForm.getMediaGrading());		swapAlbum.setSleeveGrading(swapAlbumForm.getSleeveGrading());		swapAlbum.setWaxValue(swapAlbumForm.getWaxValue());		swapAlbum.setDescription(swapAlbumForm.getDescription());		swapAlbum.setImgName(swapAlbumForm.getImgFilePath().toString());		swapAlbum.setDateAdded(new Date().toString());				System.out.println(swapAlbum.toString());				swapAlbumService.createUpdateEntity(swapAlbum);				Map<String, Object> mapInitUser = userService.initUser(user);				mav.getModel().put("hasCollection", mapInitUser.get("hasCollection"));		mav.getModel().put("userCollection", mapInitUser.get("userCollection"));		mav.getModel().put("hasWantlist", mapInitUser.get("hasWantlist"));		mav.getModel().put("userWantlist", mapInitUser.get("userWantlist"));		if (!(boolean) mapInitUser.get("hasWantlist")) {			mav.getModel().put("importWantlistModelAttribute", new PojoModelImportWantlistForm());				}				mav.setViewName("user/mySwax");				return mav;	}
}
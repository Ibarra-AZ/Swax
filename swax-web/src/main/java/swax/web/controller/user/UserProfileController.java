package swax.web.controller.user;
import javax.servlet.http.HttpServletRequest;import javax.validation.Valid;import org.apache.log4j.Logger;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.ModelMap;import org.springframework.validation.BindingResult;import org.springframework.web.bind.annotation.ModelAttribute;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestMethod;import org.springframework.web.servlet.ModelAndView;import swax.web.component.sessionscope.SessionUser;import swax.web.form.PojoModelRegisterForm;import swax.web.mav.utils.MavUtil;import swax.webservice.entity.user.User;import swax.webservice.service.album.IAlbumDiscogsService;import swax.webservice.service.user.IUserService;/** *  * @author Matthieu Ibarra * */
@Controllerpublic class UserProfileController {
	@Autowired	private IUserService userService;		@Autowired	IAlbumDiscogsService albumDiscogsService;		@Autowired	private MavUtil mavUtil = null;		@Autowired	private SessionUser sessionUser;		private Logger logger = Logger.getLogger(this.getClass());		String errorMsg = "";
	@RequestMapping(value="/loadUserProfilePage", method = RequestMethod.GET)	public ModelAndView changeUserProfile(@Valid @ModelAttribute(value="registerModelAttribute") 		final PojoModelRegisterForm registerForm, 		final BindingResult pBindingResult, HttpServletRequest request, final ModelMap pModel) {				logger.debug(this.getClass().getName()+": changeUserProfile");				ModelAndView mav = new ModelAndView();		User user = sessionUser.getSessionUser();				registerForm.setEmail(user.getEmail());		registerForm.setUserName(user.getUserName());		registerForm.setCountry(user.getCountry());		registerForm.setDiscogsName(user.getDiscogsName());				mav.getModel().put("registerModelAttribute", registerForm);		mav.setViewName("user/changeProfile");				return mav;	}		@RequestMapping(value="/changeProfileAction", method = RequestMethod.POST)	public ModelAndView changeProfileAction(@Valid @ModelAttribute(value="registerModelAttribute") 		final PojoModelRegisterForm registerForm, 		final BindingResult pBindingResult, HttpServletRequest request, ModelAndView mav) {				logger.debug(this.getClass().getName()+": changeProfileAction");				User user = sessionUser.getSessionUser();				user.setUserName(registerForm.getUserName());		user.setEmail(registerForm.getEmail());		user.setPassword(registerForm.getPassword());		user.setCountry(registerForm.getCountry());		user.setDiscogsName(registerForm.getDiscogsName());				userService.createUpdateEntity(user);				return mav = mavUtil.mySwax(user);	}		@RequestMapping(value="/backToMySwax")	public ModelAndView backToMySwax(HttpServletRequest request, ModelAndView mav) {				logger.debug(this.getClass().getName()+": backToMySwax");		errorMsg = "";				User user = sessionUser.getSessionUser();					mav = mavUtil.mySwaxUsingSession(user);		mav.getModel().put("errorMsg", errorMsg);				return mav;	}		@RequestMapping(value="/backToMySwaxRefresh")	public ModelAndView backToMySwaxRefresh(HttpServletRequest request, ModelAndView mav) {				logger.debug(this.getClass().getName()+": backToMySwaxRefresh");		errorMsg = "";				User user = sessionUser.getSessionUser();				mav = mavUtil.mySwax(user);		mav.getModel().put("errorMsg", errorMsg);				return mav;	}	
}